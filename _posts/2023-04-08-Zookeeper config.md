---
layout: post
title: Apache Zoopkeeper config
date: 2023-04-08 00:00 +0800
last_modified_at: 2023-04-08 00:08:25 +0800
tags: [Zoopkeeper, kafka , zoo.cnf]
categoie: [Zoopkeeper]
toc:  true
---
**Apache Zoopkeeper config**!
{: .message }

# Zookeeper 란? 

ZooKeeper는 분산 시스템에서 사용되는 분산 코디네이션 서비스입니다. 분산 시스템에서는 여러 대의 서버로 구성되어 작동하기 때문에 서로 간의 상태 동기화와 각 서버의 역할 분배, 락 관리 등의 문제가 발생할 수 있습니다. 이러한 문제를 해결하기 위해 분산 코디네이션 서비스인 ZooKeeper가 사용됩니다.

ZooKeeper는 높은 가용성과 일관성을 제공하는 데이터 저장소로 사용됩니다. 클러스터링 된 서버 간의 데이터를 동기화하고, 클라이언트 애플리케이션의 요청을 처리하며, 락과 세마포어와 같은 동기화 기능을 제공합니다. 이를 통해 다양한 분산 시스템에서 일관성 있는 데이터와 안정적인 작동을 보장할 수 있습니다.

ZooKeeper는 Apache 소프트웨어 재단에서 오픈소스로 개발되었으며, 자바 언어로 작성되었습니다. ZooKeeper는 다양한 분산 시스템에서 사용되고 있으며, Hadoop, Kafka, Storm 등의 대규모 분산 시스템에서도 사용됩니다.

Zookeeper로 아래와 같이 config를 설정해서 하나하나 사용하면 해보고 작성해봤습니다.

zookeeper.properties

```
tickTime=2000
dataDir=/tmp/zookeeper
clientPort=2181
initLimit=5
syncLimit=2
server.1=zoo1:2888:3888
server.2=zoo2:2888:3888
server.3=zoo3:2888:3888
minSessionTimeout=4000
maxSessionTimeout=40000

```

## TickTime
TickTime는 Apache ZooKeeper에서 사용되는 시간 단위이며, ZooKeeper 내부의 많은 기능과 프로세스에서 사용됩니다. TickTime을 설정하는 것은 ZooKeeper 클러스터의 성능 및 안정성에 큰 영향을 미칩니다.

ZooKeeper의 기본 tickTime은 3,000 밀리초(3 초)입니다. 일반적으로 이 값은 변경하지 않고 사용할 수 있지만, 클러스터의 특정 요구 사항에 따라 조정할 수도 있습니다. TickTime 값이 너무 작으면 ZooKeeper 서버의 부하가 증가하고, 값이 너무 크면 특정 작업이 수행되는 데 시간이 오래 걸리는 등의 문제가 발생할 수 있습니다.

tickTime을 설정하려면, ZooKeeper 구성 파일(zookeeper.properties)에서 "tickTime" 속성을 찾아 값을 수정하면 됩니다. 일반적으로 2,000밀리초에서 10,000밀리초 사이의 값을 사용합니다. 설정을 변경한 후 ZooKeeper 서버를 다시 시작해야 합니다.

예를 들어, tickTime을 5,000 밀리초(5 초)로 설정하려면 다음과 같이 zookeeper.properties 파일을 수정합니다.
tickTime=5000
그러나 tickTime 값을 변경할 때는 주의해야 합니다. 만약 클러스터의 모든 노드가 동일한 tickTime 값을 사용하지 않으면 클러스터 안정성 문제가 발생할 수 있습니다. 따라서 모든 노드에서 tickTime 값을 동일하게 유지하도록 주의해야 합니다.

예를 들어, 클러스터의 노드 수가 매우 큰 경우(수백 대 이상), 기본 tickTime 값(3,000밀리초)으로는 노드 간의 통신이 충분히 빠르지 않을 수 있습니다. 이러한 경우 tickTime 값을 감소시켜 노드 간 통신 속도를 높일 수 있습니다.

반대로, 노드 수가 적은 작은 규모의 클러스터에서는 tickTime 값을 증가시키는 것이 더 적합할 수 있습니다. 노드가 작으면 노드 간 통신에 드는 부하가 크지 않기 때문에 더 큰 tickTime 값으로도 충분히 안정적인 동작이 가능합니다.

또한, 클러스터에서 처리하는 데이터의 양과 복잡성에 따라도 tickTime 값을 조정할 수 있습니다. 대용량 데이터 처리나 높은 복잡성의 애플리케이션의 경우 tickTime 값을 작게 설정하면 처리 속도를 높일 수 있습니다.

요약하자면, 클러스터의 특정 요구사항은 노드 수, 데이터 양 및 복잡성, 처리 속도 등 여러 가지 요소에 따라 달라질 수 있습니다. 적절한 tickTime 값을 설정하는 것은 클러스터의 안정성과 성능을 유지하는 데 매우 중요합니다.


## initLimit

ZooKeeper 서버가 부팅 중 노드를 초기화하고 리더 노드를 선출하는 데 걸리는 시간을 설정하는 속성입니다.

이 값은 tickTime의 배수로 설정됩니다. 예를 들어, tickTime이 2000ms(즉, 2초)로 설정되어 있고, initLimit이 10이면 ZooKeeper 서버가 부팅 중 노드를 초기화하고 리더 노드를 선출하는 데 최대 20초(2초 x 10)가 걸릴 수 있습니다.

이 속성은 ZooKeeper 서버의 부팅 시간과 관련이 있으며, 적절한 값으로 설정하지 않으면 ZooKeeper 서버가 시작되지 않거나 클라이언트가 제대로 연결되지 않을 수 있습니다.

기본값은 10이며, 보통은 이 값을 변경할 필요가 없습니다. 그러나 대규모 클러스터에서는 이 값을 더 높게 설정해야 할 수도 있습니다. 예를 들어, 100대 이상의 서버로 구성된 클러스터에서는 initLimit을 50 이상으로 설정하는 것이 좋습니다.


# syncLimit
ZooKeeper는 데이터를 분산 저장하고, 모든 서버 간에 동기화를 유지해야 하므로, 데이터의 일관성을 유지하기 위해 일정 시간 이내에 모든 서버 간에 데이터를 동기화하는 것이 중요합니다. syncLimit은 이러한 데이터 동기화에 소요되는 시간 제한을 설정하며, tickTime의 배수로 설정됩니다.

예를 들어, tickTime이 2000ms(즉, 2초)로 설정되어 있고, syncLimit이 2이면 ZooKeeper 서버 간에 데이터를 동기화하는 데 최대 4초(2초 x 2)가 걸릴 수 있습니다.

이 값은 ZooKeeper 클러스터의 안정성과 성능에 영향을 미치므로, 적절한 값을 설정하는 것이 중요합니다. 일반적으로 기본값인 2로 설정되어 있으며, 대부분의 경우 이 값을 변경할 필요는 없습니다. 그러나 네트워크 상태가 불안정한 경우에는 이 값을 높여야 할 수 있습니다.


# server.x 설정

server.x 설정은 ZooKeeper 서버 간에 통신을 위해 사용되는 설정입니다.

ZooKeeper는 분산 시스템에서 사용되기 때문에, 여러 대의 서버가 클러스터를 형성하고 데이터를 동기화합니다. server.x 설정은 이러한 서버 간의 통신을 설정하는 데 사용됩니다.

x는 서버의 고유 ID를 나타내며, server.x 설정은 해당 서버의 주소와 포트 번호를 설정합니다. zoo1:2888:3888과 같이 설정되어 있으면 zoo1은 서버의 호스트 이름 또는 IP 주소를, 2888은 서버 간의 통신을 위한 포트 번호를, 3888은 리더 선출을 위한 포트 번호를 나타냅니다.

서버 간의 통신은 항상 server.x 형식으로 설정된 IP 주소와 포트 번호를 통해 이루어지며, 서버가 추가되거나 삭제될 때 이러한 설정을 업데이트해야 합니다. 따라서 server.x 설정은 ZooKeeper 클러스터의 구성을 설정하는 데 중요한 역할을 합니다.


# minSessionTimeout

ZooKeeper 클라이언트는 ZooKeeper 서버와의 세션을 유지해야 하며, 이 세션은 클라이언트가 서버로부터 데이터를 읽거나 쓰는 데 사용됩니다. 클라이언트와 서버 간의 통신이 중단되거나 서버가 재시작되는 등의 상황에서 세션은 만료될 수 있습니다.

minSessionTimeout은 클라이언트 세션이 유지되는 최소 시간을 나타내며, 이 시간보다 짧은 세션은 만들 수 없습니다. 이를 통해 클라이언트가 너무 짧은 세션을 만들어 서버에 부하를 주는 것을 방지할 수 있습니다.

minSessionTimeout의 기본값은 2배의 tickTime입니다. 예를 들어, tickTime이 2000ms(즉, 2초)로 설정되어 있으면 minSessionTimeout은 4000ms(즉, 4초)입니다.

minSessionTimeout은 클라이언트와 서버 간의 통신을 안정적으로 유지하기 위해 중요한 속성이며, 이 값을 적절하게 설정하는 것이 중요합니다. 클러스터의 부하 상황, 네트워크 상태 등을 고려하여 값을 조정해야 합니다.

# maxSessionTimeout

ZooKeeper 클라이언트는 ZooKeeper 서버와의 세션을 유지해야 하며, 이 세션은 클라이언트가 서버로부터 데이터를 읽거나 쓰는 데 사용됩니다. 클라이언트와 서버 간의 통신이 중단되거나 서버가 재시작되는 등의 상황에서 세션이 만료됩니다.

maxSessionTimeout은 클라이언트 세션이 유지되는 최대 시간을 나타내며, 이 시간보다 긴 세션은 만들 수 없습니다. 이를 통해 클라이언트가 너무 긴 세션을 만들어 서버에 지속적인 연결을 유지하는 것을 방지할 수 있습니다.

maxSessionTimeout의 기본값은 20배의 tickTime입니다. 예를 들어, tickTime이 2000ms(즉, 2초)로 설정되어 있으면 maxSessionTimeout은 40000ms(즉, 40초)입니다.

maxSessionTimeout은 클라이언트와 서버 간의 통신을 안정적으로 유지하기 위해 중요한 속성이며, 이 값을 적절하게 설정하는 것이 중요합니다. 클러스터의 부하 상황, 네트워크 상태 등을 고려하여 값을 조정해야 합니다.

