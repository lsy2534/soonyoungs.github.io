---
layout: post
title: Kafka Options
date: 2023-03-20 00:00 +0800
last_modified_at: 2023-03-20 00:08:25 +0800
tags: [kafka, kafka-option]
categoie: [kafka]
toc:  true
---
**Kafka Option**!
{: .message }

Apache Kafka는 다양한 옵션을 제공하여 더욱 유연하고 세밀한 설정이 가능하다. 일부 주요 옵션에 대해 알아본다.
카프카(Kafka)는 분산 스트리밍 플랫폼으로, 대용량의 실시간 데이터 스트림 처리에 사용된다. 카프카는 다양한 옵션을 제공하여 사용자가 필요에 맞게 설정할 수 있도록 해준다. 아래와 같이 카프카 옵션을 자세히 알아보고자 한다.

## Kafka Option
1. Broker 관련 옵션:
broker.id: Kafka에서 broker.id는 Kafka 브로커를 구분하는 유일한 식별자입니다. 브로커 ID는 클러스터의 안정적인 동작을 위해 매우 중요합니다.  

broker.id가 -1로 설정되면 브로커는 ID를 자동으로 할당받습니다. 이 기능은 브로커 ID를 설정하는 번거로움을 덜어주고, 브로커 ID 충돌을 방지할 수 있습니다. 이 기능은 Kafka 0.8.2 이후 버전에서 추가되었습니다.  
브로커 ID가 -1인 경우, 브로커는 다른 브로커와의 연결을 맺을 때 랜덤으로 생성된 ID를 사용합니다. 이렇게 생성된 브로커 ID는 브로커가 시작될 때 로그에 출력됩니다. 이 값을 확인하여 브로커 ID가 중복되지 않도록 해야 합니다.
broker.id를 -1로 설정하는 것은 브로커 ID를 자동으로 할당받는 편리한 방법입니다. 그러나 이 값이 설정되면 브로커 ID가 어떤 값으로 설정되는지 알 수 없으므로, 브로커 ID를 명시적으로 설정하는 것이 좋습니다. 브로커 ID가 중복되면 클러스터의 안정성에 영향을 줄 수 있으므로, 브로커 ID를 설정할 때는 각 브로커의 ID가 서로 다르도록 유의해야 합니다. 

background.threads: 옵션은 Kafka 브로커에서 백그라운드 작업을 처리하는 스레드 수를 지정하는 옵션입니다.
Kafka 브로커는 여러 가지 백그라운드 작업을 수행합니다. 예를 들어, 파티션의 리더 선출, 로그 파일의 롤링, 인덱스 파일의 정리 등이 있습니다. 이러한 백그라운드 작업은 브로커의 안정성과 성능에 영향을 미칩니다. 따라서 background.threads 옵션을 사용하여 백그라운드 작업을 처리하는 스레드 수를 조정하여 브로커의 안정성과 성능을 조절할 수 있습니다.

background.threads 옵션의 기본값은 10입니다. 이 값을 늘리면 백그라운드 작업을 더 빠르게 처리할 수 있지만, 브로커의 CPU 사용량이 증가하여 성능 저하를 일으킬 수 있습니다. 따라서 background.threads 옵션을 설정할 때는 시스템 리소스와 브로커의 특성에 따라 적절한 값을 선택해야 합니다.

예를 들어, 다음과 같이 background.threads를 20으로 설정하면 백그라운드 작업을 더 많이 처리할 수 있습니다.
```
background.threads=20
```

compression.type : 옵션은 프로듀서가 전송하는 메시지의 압축 방식을 설정하는 옵션입니다.
Kafka는 메시지를 전송할 때 메시지의 크기를 줄이기 위해 압축 기능을 제공합니다. compression.type 옵션은 이러한 압축 기능을 사용할 때 어떤 압축 방식을 사용할 것인지 지정합니다.

Kafka는 다음과 같은 압축 방식을 지원합니다.

* none(uncompressed): 압축을 사용하지 않습니다. 메시지를 그대로 전송합니다.
* gzip: Gzip 알고리즘을 사용하여 압축합니다.
* snappy: Snappy 알고리즘을 사용하여 압축합니다.
* lz4: LZ4 알고리즘을 사용하여 압축합니다.
기본값은 none입니다.

압축을 사용하면 데이터 전송 속도를 높이고, 전송하는 데이터의 양을 줄일 수 있습니다. 그러나 압축은 CPU 사용량을 높이기 때문에, 브로커와 프로듀서 사이의 대역폭이 충분하지 않은 경우 압축을 사용하면 오히려 성능이 저하될 수 있습니다.

zookeeper.connect:
카프카 클러스터 구성원인 브로커와 컨트롤러가 사용하는 주키퍼(zookeeper)의 호스트와 포트 정보를 설정하는 옵션이다.

2. Topic 관련 옵션:
num.partitions:
토픽의 파티션 수를 설정하는 옵션입니다. 파티션은 데이터를 분산하여 저장하고 처리하는 데 사용됩니다.
replication.factor: 각 파티션에 대해 복제본 수를 지정한다.
partition.assignment.strategy: 브로커에 새로운 토픽이 생성될 때 파티션 할당 방식을 지정합니다.
retention.ms: 메시지를 보관할 시간을 지정합니다.
offset.topic.replication.factor :
카프카 내부에서 사용되는 offset topic의 복제본 수를 결정하는 옵션입니다. offset topic은 컨슈머 그룹의 오프셋 정보를 저장하는 토픽입니다.
group.initial.rebalance.delay.ms:
컨슈머 그룹이 생성될 때, rebalance가 발생하기 전까지의 지연 시간을 설정하는 옵션입니다. rebalance란, 컨슈머 그룹 내에서 파티션 할당이가능하다.